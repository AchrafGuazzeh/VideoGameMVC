<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Bibliothèque de Jeux</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.4/font/bootstrap-icons.css">
    <link th:href="@{/css/custom.css}" rel="stylesheet"/>
</head>
<body class="bg-light">
<!-- header -->
<div th:insert="layout :: siteHeader"></div>

<main class="container mt-4">
    <div class="d-flex align-items-center mb-3">
        <div>
            <h1 class="h3 mb-0">Bibliothèque de Jeux</h1>
            <p class="text-muted mb-0">Gérez vos jeux, studios et genres</p>
        </div>
        <div class="ms-auto">
            <!-- Link now points to /games/new -->
            <a class="btn btn-primary" th:href="@{/games/new}"><i class="bi bi-plus-lg"></i> Ajouter un jeu</a>
        </div>
    </div>

    <div th:if="${message}" class="alert alert-success" role="alert" th:text="${message}"></div>
    <div th:if="${errorMessage}" class="alert alert-danger" role="alert" th:text="${errorMessage}"></div>

    <div class="card shadow-sm">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover table-striped align-middle mb-0">
                    <thead class="table-light">
                    <tr>
                        <th style="width: 60px;">ID</th>
                        <th>Titre</th>
                        <th>Plateforme</th>
                        <th>Date de sortie</th>
                        <th>Prix</th>
                        <th>Studio</th>
                        <th>Genres</th>
                        <th style="width: 170px;">Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="game : ${games}">
                        <td th:text="${game.id}">1</td>
                        <td>
                            <div class="fw-semibold" th:text="${game.title}">Game title</div>
                            <div class="small text-muted"
                                 th:text="${game.description != null ? (game.description.length() > 120 ? game.description.substring(0,120) + '...' : game.description) : ''}">
                            </div>
                        </td>
                        <td th:text="${game.platform} ?: '-'">PC</td>
                        <td th:text="${game.releaseDate} ?: '-'">2020-01-01</td>
                        <td th:text="${game.price != null ? game.price + ' €' : '-'}">49.99 €</td>
                        <td th:text="${game.studio != null ? game.studio.name : '-'}">Studio</td>

                        <td>
                            <span th:if="${game.genres == null or #lists.isEmpty(game.genres)}">-</span>
                            <span th:each="g : ${game.genres}">
                                <span class="badge bg-secondary me-1" th:text="${g.name}">Action</span>
                            </span>
                        </td>

                        <td>
                            <!-- Edit and delete now point to /games/edit/{id} and /games/delete/{id} -->
                            <a class="btn btn-sm btn-outline-primary me-1" th:href="@{|/games/edit/${game.id}|}">
                                <i class="bi bi-pencil"></i> Modifier
                            </a>
                            <a class="btn btn-sm btn-outline-danger" th:href="@{|/games/delete/${game.id}|}"
                               onclick="return confirm('Supprimer ce jeu ?')">
                                <i class="bi bi-trash"></i> Supprimer
                            </a>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <div th:if="${#lists.isEmpty(games)}" class="p-3 text-center text-muted">
                    Aucun jeu trouvé. <a th:href="@{/games/new}">Ajouter un jeu</a>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- footer -->
<div th:insert="layout :: siteFooter"></div>
</body>
</html>